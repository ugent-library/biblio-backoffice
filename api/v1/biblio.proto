// make sure you have the protoc compiler
// and install the go plugins with
// go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
// go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
// then generate with
// protoc --go_out=. --go_opt=paths=source_relative --go-grpc_out=. --go-grpc_opt=paths=source_relative api/v1/biblio.proto

syntax = "proto3";

package biblio.v1;

option go_package = "github.com/ugent-library/biblio-backend/api/v1";

import "google/protobuf/timestamp.proto";

service Biblio {
    rpc GetFile(GetFileRequest) returns (stream GetFileResponse);
    rpc AddFile(stream AddFileRequest) returns (AddFileResponse);
    rpc GetPublication(GetPublicationRequest) returns (GetPublicationResponse);
    rpc GetAllPublications(GetAllPublicationsRequest) returns (stream GetAllPublicationsResponse);
    rpc SearchPublications(SearchPublicationsRequest) returns (SearchPublicationsResponse);
    rpc UpdatePublication(UpdatePublicationRequest) returns (UpdatePublicationResponse);
    rpc AddPublications(stream AddPublicationsRequest) returns (stream AddPublicationsResponse);
    rpc ImportPublications(stream ImportPublicationsRequest) returns (stream ImportPublicationsResponse);
    rpc GetPublicationHistory(GetPublicationHistoryRequest) returns (stream GetPublicationHistoryResponse);
    rpc PurgePublication(PurgePublicationRequest) returns (PurgePublicationResponse);
    rpc PurgeAllPublications(PurgeAllPublicationsRequest) returns (PurgeAllPublicationsResponse);
    rpc ValidatePublications(stream ValidatePublicationsRequest) returns (stream ValidatePublicationsResponse);
    rpc GetDataset(GetDatasetRequest) returns (GetDatasetResponse);
    rpc GetAllDatasets(GetAllDatasetsRequest) returns (stream GetAllDatasetsResponse);
    rpc SearchDatasets(SearchDatasetsRequest) returns (SearchDatasetsResponse);
    rpc UpdateDataset(UpdateDatasetRequest) returns (UpdateDatasetResponse);
    rpc AddDatasets(stream AddDatasetsRequest) returns (stream AddDatasetsResponse);
    rpc ImportDatasets(stream ImportDatasetsRequest) returns (stream importDatasetsResponse);
    rpc GetDatasetHistory(GetDatasetHistoryRequest) returns (stream GetDatasetHistoryResponse);
    rpc PurgeDataset(PurgeDatasetRequest) returns (PurgeDatasetResponse);
    rpc PurgeAllDatasets(PurgeAllDatasetsRequest) returns (PurgeAllDatasetsResponse);
    rpc ValidateDatasets(stream ValidateDatasetsRequest) returns (stream ValidateDatasetsResponse);
    rpc Relate(RelateRequest) returns (RelateResponse);
}

enum Confirmation {
    CONFIRMATION_YES = 0;
    CONFIRMATION_NO = 1;
    CONFIRMATION_DONT_KNOW = 2;
}

message Text {
    string id = 1;
    string lang = 2; // TODO should be enum
    string text = 3;
}

message ContributorDepartment {
    string id = 1;
    string name = 2;
}

message Contributor {
    string id = 1;
    string orcid = 2;
    repeated string local_id = 3;
    repeated string credit_role = 4; // TODO should be enum
    string first_name = 5;
    string last_name = 6;
    string full_name = 7;
    repeated ContributorDepartment department = 8;
}

message Department {
    string id = 1;
    repeated DepartmentRef tree = 2;
}

message DepartmentRef {
    string id = 1;
}

message RelatedUser {
    string id = 1;
    string name = 2;
}

message RelatedPublication {
    string id = 1;
}

message RelatedProject {
    string id = 1;
    string name = 2;
}

message RelatedDataset {
    string id = 1;
}

message OrcidWork {
    string orcid = 1;
    int32 put_code = 2;
}

message Link {
    enum Relation {
        RELATION_DATA_MANAGEMENT_PLAN = 0;
        RELATION_HOME_PAGE = 1;
        RELATION_PEER_REVIEW_REPORT = 2;
        RELATION_RELATED_INFORMATION = 3;
        RELATION_SOFTWARE = 4;
        RELATION_TABLE_OF_CONTENTS = 5;
        RELATION_MAIN_FILE = 6;
    }

    string id  = 1;
    string url = 2;
    Relation relation = 3;
    string description = 4;
}

message File {
    enum AccessLevel {
        ACCESS_LEVEL_CLOSED_ACCESS = 0;
        ACCESS_LEVEL_EMBARGOED_ACCESS = 1;
        ACCESS_LEVEL_RESTRICTED_ACCESS = 2;
        ACCESS_LEVEL_OPEN_ACCESS = 3;
    }

    enum PublicationVersion {
        PUBLICATION_VERSION_PUBLISHED_VERSION = 0;
        PUBLICATION_VERSION_AUTHOR_VERSION = 1;
        PUBLICATION_VERSION_ACCEPTED_VERSION = 2;
        PUBLICATION_VERSION_UPDATED_VERSION = 3;
    }

    enum Relation {
        RELATION_MAIN_FILE = 0;
        RELATION_COLOPHON = 1;
        RELATION_DATA_FACT_SHEET = 2;
        RELATION_PEER_REVIEW_REPORT = 3;
        RELATION_TABLE_OF_CONTENTS = 4;
        RELATION_AGREEMENT = 5;
        RELATION_SUPPLEMENTARY_MATERIAL = 6;
    }

    string id = 1;
    AccessLevel access_level = 2;
    string license = 3;
    string content_type = 4;
    google.protobuf.Timestamp date_created = 5;
    google.protobuf.Timestamp date_updated = 6;
    string embargo_date = 7;
    AccessLevel access_level_after_embargo = 8;
    AccessLevel access_level_during_embargo = 9;
    string name = 10;
    int32 size = 11;
    string sha256 = 12;
    string other_license = 13;
    PublicationVersion publication_version = 14;
    Relation relation = 15;
}

message Publication {

    enum PublicationStatus {
        PUBLICATION_STATUS_UNPUBLISHED = 0;
        PUBLICATION_STATUS_ACCEPTED = 1;
        PUBLICATION_STATUS_PUBLISHED = 2;
    }

    enum Type {
	   TYPE_JOURNAL_ARTICLE = 0;
	   TYPE_BOOK = 1;
	   TYPE_BOOK_CHAPTER = 2;
	   TYPE_BOOK_EDITOR = 3;
	   TYPE_ISSUE_EDITOR = 4;
	   TYPE_CONFERENCE = 5;
	   TYPE_DISSERTATION = 6;
	   TYPE_MISCELLANEOUS = 7;
    }

    enum JournalArticleType {
       JOURNAL_ARTICLE_TYPE_ORIGINAL = 0;
       JOURNAL_ARTICLE_TYPE_REVIEW = 1;
       JOURNAL_ARTICLE_TYPE_LETTER_NOTE = 2;
       JOURNAL_ARTICLE_TYPE_PROCEEDINGS_PAPER = 3;
    }

    enum ConferenceType {
        CONFERENCE_TYPE_PROCEEDINGS_PAPER = 0;
        CONFERENCE_TYPE_ABSTRACT = 1;
        CONFERENCE_TYPE_POSTER = 2;
        CONFERENCE_TYPE_OTHER = 3;
    }

    enum MiscellaneousType {
        MISCELLANEOUS_TYPE_ART_REVIEW = 0;
        MISCELLANEOUS_TYPE_ARTISTIC_WORK = 1;
        MISCELLANEOUS_TYPE_BIBLIOGRAPHY = 2;
        MISCELLANEOUS_TYPE_BIOGRAPHY = 3;
        MISCELLANEOUS_TYPE_BLOG_POST = 4;
        MISCELLANEOUS_TYPE_BOOK_REVIEW = 5;
        MISCELLANEOUS_TYPE_CORRECTION = 6;
        MISCELLANEOUS_TYPE_DICTIONARY_ENTRY = 7;
        MISCELLANEOUS_TYPE_EDITIORIAL_MATERIAL = 8;
        MISCELLANEOUS_TYPE_ENCYCLOPEDIA_ENTRY = 9;
        MISCELLANEOUS_TYPE_EXHIBITION_REVIEW = 10;
        MISCELLANEOUS_TYPE_FILM_REVIEW = 11;
        MISCELLANEOUS_TYPE_LECTURE_SPEECH = 12;
        MISCELLANEOUS_TYPE_LEMMA = 13;
        MISCELLANEOUS_TYPE_MAGAZINE_PIECE = 14;
        MISCELLANEOUS_TYPE_MANUAL = 15;
        MISCELLANEOUS_TYPE_MUSIC_EDITION = 16;
        MISCELLANEOUS_TYPE_MUSIC_REVIEW = 17;
        MISCELLANEOUS_TYPE_NEWS_ARTICLE = 18;
        MISCELLANEOUS_TYPE_NEWSPAPER_PIECE = 19;
        MISCELLANEOUS_TYPE_OTHER = 20;
        MISCELLANEOUS_TYPE_PREPRINT = 21;
        MISCELLANEOUS_TYPE_PRODUCT_REVIEW = 22;
        MISCELLANEOUS_TYPE_REPORT = 23;
        MISCELLANEOUS_TYPE_TECHNICAL_STANDARD = 24;
        MISCELLANEOUS_TYPE_TEXT_EDITION = 25;
        MISCELLANEOUS_TYPE_TEXT_TRANSLATION = 26;
        MISCELLANEOUS_TYPE_THEATRE_REVIEW = 27;
        MISCELLANEOUS_TYPE_WORKING_PAPER = 28;
    }

    enum Status {
	    STATUS_PRIVATE = 0;
	    STATUS_PUBLIC = 1;
	    STATUS_DELETED = 2;
	    STATUS_RETURNED = 3;
    }

    enum Classification {
        CLASSIFICATION_U = 0;
        CLASSIFICATION_A1 = 1;
        CLASSIFICATION_A2 = 2;
        CLASSIFICATION_A3 = 3;
        CLASSIFICATION_A4 = 4;
        CLASSIFICATION_B1 = 5;
        CLASSIFICATION_B2 = 6;
        CLASSIFICATION_B3 = 7;
        CLASSIFICATION_C1 = 8;
        CLASSIFICATION_C3 = 9;
        CLASSIFICATION_D1 = 10;
        CLASSIFICATION_D2 = 11;
        CLASSIFICATION_P1 = 12;
        CLASSIFICATION_V = 13;
    }

    string id = 1;
    Type type = 2;
    Status status = 3;
    repeated Text abstract = 4;
    string additional_info = 5;
    repeated string alternative_title = 6;
    string article_number = 7;
    string arxiv_id = 8;
    repeated Contributor author = 9;
    string batch_id = 10;
    Classification classification = 11;
    google.protobuf.Timestamp date_created = 12;
    google.protobuf.Timestamp date_updated = 13;
    google.protobuf.Timestamp date_from = 14;
    google.protobuf.Timestamp date_until = 15;
    bool extern = 16;
    string title = 17;
    string defense_place = 18;
    string defense_date = 19;
    string defense_time = 20;
    string conference_name = 21;
    string conference_location = 22;
    string conference_organizer = 23;
    string conference_start_date = 24;
    string conference_end_date = 25;
    repeated Department department = 26;
    RelatedUser creator = 27;
    RelatedUser user = 28;
    string doi = 29;
    string edition = 30;
    repeated Contributor editor = 31;
    repeated string eisbn = 32;
    repeated string eissn = 33;
    string esci_id = 34;
    repeated File file = 35;
    string handle  = 36;
    Confirmation has_confidential_data = 37;
    Confirmation has_patent_application = 38;
    Confirmation has_publications_planned = 39;
    Confirmation has_published_material = 40;
    repeated string isbn = 41;
    repeated string issn = 42;
    string issue = 43;
    string issue_title = 44;
    repeated string keyword = 45;
    repeated string language = 46; // TODO should be enum
    repeated Text lay_summary = 47;
    repeated Contributor supervisor = 48;
    string volume = 49;
    string wos_id = 50;
    string wos_type = 51;
    string year = 52;
    string report_number = 53;
    repeated string research_field = 54;
    string reviewer_note = 55;
    repeated string reviewer_tags = 56;
    string series_title = 57;
    string snapshot_id = 58;
    string source_db = 59;
    string source_id = 60;
    string source_record = 61;
    bool locked = 62;
    string message = 63;
    string page_count = 64;
    string page_first = 65;
    string page_last = 66;
    string place_of_publication = 67;
    string publication = 68;
    string publication_abbreviation = 69;
    string publisher = 70;
    string pubmed_id = 71;
    JournalArticleType journal_article_type = 72; // TODO use Oneof
    ConferenceType conference_type = 73; // TODO use Oneof
    MiscellaneousType miscellaneous_type = 74; // TODO use Oneof
    repeated RelatedProject project = 75;
    repeated RelatedDataset related_dataset = 76;
    repeated Link link = 77;
    repeated OrcidWork orcid_work = 78;
    bool legacy = 79;
    string vabb_type = 80;
    string vabb_id = 81;
    bool vabb_approved = 82;
    repeated string vabb_year = 83;
    bool has_been_public = 84;
    PublicationStatus publication_status = 85;
}

message Dataset {
    enum Status {
	    STATUS_PRIVATE = 0;
	    STATUS_PUBLIC = 1;
	    STATUS_DELETED = 2;
	    STATUS_RETURNED = 3;
    }

	// "access_levels": {
	// 	"info:eu-repo/semantics/closedAccess",
	// 	"info:eu-repo/semantics/embargoedAccess",
	// 	"info:eu-repo/semantics/restrictedAccess",
	// 	"info:eu-repo/semantics/openAccess",
	// },

    enum AccessLevel {
        ACCESS_LEVEL_CLOSED_ACCESS = 0;
        ACCESS_LEVEL_EMBARGOED_ACCESS = 1;
        ACCESS_LEVEL_RESTRICTED_ACCESS = 2;
        ACCESS_LEVEL_OPEN_ACCESS = 3;
    }

    string id = 1;
    Status status = 2;
    repeated Text abstract = 3;
    repeated Contributor author = 4;
    string batch_id = 5;
    google.protobuf.Timestamp date_created = 6;
    google.protobuf.Timestamp date_updated = 7;
    google.protobuf.Timestamp date_from = 8;
    google.protobuf.Timestamp date_until = 9;
    string title = 10;
    RelatedUser creator = 11;
    RelatedUser user = 12;
    string doi = 13;
    repeated string keyword = 14;
    string url = 15;
    string year = 16;
    string reviewer_note = 17;
    repeated string reviewer_tags = 18;
    string snapshot_id = 19;
    string message = 20;
    string publisher = 21;
    repeated RelatedProject project = 22;
    repeated RelatedPublication related_publication = 23;
    AccessLevel access_level = 24;
    repeated Contributor contributor = 25;
    string embargo_date = 26;
    AccessLevel access_level_after_embargo = 27;
    repeated string format = 28;
    string license = 29;
    bool locked = 30;
    string other_license = 31;
    repeated Department department = 32;
    bool has_been_public = 33;
}

message GetFileRequest {
    string sha256 = 1;
}

message GetFileResponse {
    bytes chunk = 1;
}

message AddFileRequest {
    bytes chunk = 1;
}

message AddFileResponse {
    string sha256 = 1;
}

message GetPublicationRequest {
    string id = 1;
}

message GetPublicationResponse {
    Publication publication = 1;
}

message GetAllPublicationsRequest {
}

message GetAllPublicationsResponse {
    Publication publication = 1;
}

message SearchPublicationsRequest {
    string query = 1;
    int32 offset = 2;
    int32 limit = 3;
}

message SearchPublicationsResponse {
    repeated Publication hits = 1;
    int32 offset = 2;
    int32 limit = 3;
    int32 total = 4;
}

message UpdatePublicationRequest {
    Publication publication = 1;
}

message UpdatePublicationResponse {
}

message AddPublicationsRequest {
    Publication publication = 1;
}

message AddPublicationsResponse {
    string message = 1;
}

message ImportPublicationsRequest {
    Publication publication = 1;
}

message ImportPublicationsResponse {
    string message = 1;
}

message GetPublicationHistoryRequest {
    string id = 1;
}

message GetPublicationHistoryResponse {
    Publication publication = 1;
}

message PurgePublicationRequest {
    string id = 1;
}

message PurgePublicationResponse {
}

message PurgeAllPublicationsRequest {
}

message PurgeAllPublicationsResponse {
}

message ValidatePublicationsRequest {
    Publication publication = 1;
}

message ValidatePublicationsResponse {
    int32 seq = 1;
    string id = 2;
    string message = 3;
}

message GetDatasetRequest {
    string id = 1;
}

message GetDatasetResponse {
    Dataset dataset = 1;
}

message GetAllDatasetsRequest {
}

message GetAllDatasetsResponse {
    Dataset dataset = 1;
}

message SearchDatasetsRequest {
    string query = 1;
    int32 offset = 2;
    int32 limit = 3;
}

message SearchDatasetsResponse {
    repeated Dataset hits = 1;
    int32 offset = 2;
    int32 limit = 3;
    int32 total = 4;
}

message UpdateDatasetRequest {
    Dataset dataset = 1;
}

message UpdateDatasetResponse {
}

message AddDatasetsRequest {
    Dataset dataset = 1;
}

message AddDatasetsResponse {
    string message = 1;
}

message ImportDatasetsRequest {
    Dataset dataset = 1;
}

message importDatasetsResponse {
    string message = 1;
}

message GetDatasetHistoryRequest {
    string id = 1;
}

message GetDatasetHistoryResponse {
    Dataset dataset = 1;
}

message PurgeDatasetRequest {
    string id = 1;
}

message PurgeDatasetResponse {
}

message PurgeAllDatasetsRequest {
}

message PurgeAllDatasetsResponse {
}

message ValidateDatasetsRequest {
    Dataset dataset = 1;
}

message ValidateDatasetsResponse {
    int32 seq = 1;
    string id = 2;
    string message = 3;
}

message RelateRequest {
    oneof one {
        string publication_one = 1;
        string dataset_one = 2;
    }
    oneof two {
        string publication_two = 3;
        string dataset_two = 4;
    }
}

message RelateResponse {
}